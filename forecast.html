<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockSymphony - Inventory Forecast & Predictions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-content">
                <div class="logo">
                    <i data-feather="package" class="logo-icon w-6 h-6"></i>
                    <span class="logo-text">StockSymphony</span>
                </div>
                <div class="flex items-center gap-4">
                    <a href="statistics.html" class="flex items-center text-gray-600 hover:text-blue-600 transition">
                        <i data-feather="bar-chart-2" class="w-4 h-4 mr-2"></i>
                        View Statistics
                    </a>
                    <a href="index.html" class="flex items-center text-gray-600 hover:text-indigo-600 transition">
                        <i data-feather="arrow-left" class="w-4 h-4 mr-2"></i>
                        Back to Inventory
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
    <main class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl shadow-lg p-6 mb-8 text-white">
            <h1 class="text-3xl font-bold mb-2 flex items-center">
                <i data-feather="trending-up" class="mr-3"></i>
                Inventory Forecast & Predictions
            </h1>
            <p class="text-purple-100">Smart predictions using Priority Queue data structure</p>
        </div>

        <!-- DSA Info Banner -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded-r-lg">
            <div class="flex items-start">
                <i data-feather="info" class="text-blue-500 mr-3 mt-1"></i>
                <div>
                    <h3 class="font-semibold text-blue-900 mb-1">DSA Implementation: Priority Queue</h3>
                    <p class="text-blue-800 text-sm">
                        This page uses a <strong>Priority Queue</strong> to prioritize reorder recommendations based on urgency score.
                        Items with lowest stock-to-usage ratio get highest priority.
                    </p>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <i data-feather="settings" class="mr-2 text-indigo-500"></i>
                Forecast Settings
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Average Daily Usage Rate
                    </label>
                    <div class="flex items-center gap-2">
                        <input type="number" id="usageRate" value="2" min="1" max="10" 
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <span class="text-gray-600 text-sm">units/day</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Reorder Threshold
                    </label>
                    <div class="flex items-center gap-2">
                        <input type="number" id="reorderThreshold" value="15" min="5" max="50" 
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <span class="text-gray-600 text-sm">units</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Lead Time (Days)
                    </label>
                    <input type="number" id="leadTime" value="7" min="1" max="30" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
            </div>
            <button onclick="runForecast()" class="mt-4 btn-primary">
                <i data-feather="zap" class="w-4 h-4 mr-2"></i>
                Generate Forecast
            </button>
        </div>

        <!-- Alert Summary -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-sm p-6 text-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-red-100 text-sm font-medium">Critical (0-3 days)</p>
                    <i data-feather="alert-circle" class="w-5 h-5"></i>
                </div>
                <p id="criticalCount" class="text-3xl font-bold">0</p>
                <p class="text-red-100 text-xs mt-1">Reorder immediately</p>
            </div>

            <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-sm p-6 text-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-orange-100 text-sm font-medium">Urgent (4-7 days)</p>
                    <i data-feather="alert-triangle" class="w-5 h-5"></i>
                </div>
                <p id="urgentCount" class="text-3xl font-bold">0</p>
                <p class="text-orange-100 text-xs mt-1">Reorder soon</p>
            </div>

            <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl shadow-sm p-6 text-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-yellow-100 text-sm font-medium">Warning (8-14 days)</p>
                    <i data-feather="info" class="w-5 h-5"></i>
                </div>
                <p id="warningCount" class="text-3xl font-bold">0</p>
                <p class="text-yellow-100 text-xs mt-1">Plan reorder</p>
            </div>

            <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-sm p-6 text-white">
                <div class="flex items-center justify-between mb-2">
                    <p class="text-green-100 text-sm font-medium">Healthy (15+ days)</p>
                    <i data-feather="check-circle" class="w-5 h-5"></i>
                </div>
                <p id="healthyCount" class="text-3xl font-bold">0</p>
                <p class="text-green-100 text-xs mt-1">Stock sufficient</p>
            </div>
        </div>

        <!-- Priority Queue Visualization -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <i data-feather="git-branch" class="mr-2 text-purple-500"></i>
                Priority Queue - Reorder Recommendations
            </h2>
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                <p class="text-sm text-gray-600 mb-2">
                    <strong>Queue Structure:</strong> Items automatically sorted by urgency score (lower = more urgent)
                </p>
                <p class="text-sm text-gray-600">
                    <strong>Operations:</strong> Enqueue with sorting, Dequeue, Peek
                </p>
            </div>
            <div id="priorityQueueContainer" class="space-y-3">
                <!-- Priority queue items will be inserted here -->
            </div>
        </div>

        <!-- Forecast Chart -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <i data-feather="bar-chart-2" class="mr-2 text-blue-500"></i>
                Stock Depletion Timeline
            </h2>
            <canvas id="forecastChart"></canvas>
        </div>

        <!-- Detailed Forecast Table -->
        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <i data-feather="list" class="mr-2 text-indigo-500"></i>
                Detailed Forecast Report
            </h2>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Item</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Current Stock</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Daily Usage</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Days Until Empty</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reorder Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Priority</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        </tr>
                    </thead>
                    <tbody id="forecastTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Forecast data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
    <script>
        // Initialize Feather icons
        feather.replace();

        
        // PRIORITY QUEUE Implementation
        // Data Structure: Array-based Priority Queue with manual sorting
        
        
        
        
        class PriorityQueue {
            constructor() {
                this.queue = [];
                this.size = 0;
                this.maxSize = 1000;
            }

            // Enqueue item with priority
            // Items are manually sorted by urgency score (ascending)
            // Lower urgency score = higher priority (more urgent)
            enqueue(item) {
                if (this.size >= this.maxSize) {
                    return false;
                }
                
                // Add item at the end
                this.queue[this.size] = item;
                this.size++;
                
                // Manual sorting using Bubble Sort (C-style)
                // Sort by urgency score in ascending order
                for (let i = 0; i < this.size - 1; i++) {
                    for (let j = 0; j < this.size - i - 1; j++) {
                        if (this.queue[j].urgencyScore > this.queue[j + 1].urgencyScore) {
                            // Manual swap without destructuring
                            let temp = this.queue[j];
                            this.queue[j] = this.queue[j + 1];
                            this.queue[j + 1] = temp;
                        }
                    }
                }
                
                return true;
            }

            // Dequeue (remove and return highest priority item)
            // Returns the first item (lowest urgency score)
            dequeue() {
                if (this.isEmpty()) {
                    return null;
                }
                
                let item = this.queue[0];
                
                // Manual shift: move all elements one position left (like C)
                for (let i = 0; i < this.size - 1; i++) {
                    this.queue[i] = this.queue[i + 1];
                }
                
                this.queue[this.size - 1] = null; // Clear last slot
                this.size--;
                return item;
            }

            // Peek at highest priority item without removing
            peek() {
                return this.size > 0 ? this.queue[0] : null;
            }

            // Get all items (for display)
            // Manual array copy
            getAll() {
                let result = new Array(this.size);
                for (let i = 0; i < this.size; i++) {
                    result[i] = this.queue[i];
                }
                return result;
            }

            // Get size
            getSize() {
                return this.size;
            }

            // Check if empty
            isEmpty() {
                return this.size === 0;
            }

            // Clear queue
            clear() {
                for (let i = 0; i < this.size; i++) {
                    this.queue[i] = null;
                }
                this.size = 0;
            }
        }

        let forecastData = [];
        let priorityQueue = new PriorityQueue();
        let forecastChart = null;

        
        // Generate Forecast
        // Algorithm: Calculates stock depletion using linear projection
        // Uses Priority Queue to rank items by urgency
        
        function runForecast() {
            // Get settings
            const usageRate = parseFloat(document.getElementById('usageRate').value);
            const reorderThreshold = parseFloat(document.getElementById('reorderThreshold').value);
            const leadTime = parseInt(document.getElementById('leadTime').value);

            // Get inventory from localStorage
            const inventoryData = JSON.parse(localStorage.getItem('inventoryStats') || '{}');
            
            if (!inventoryData.items || inventoryData.items.length === 0) {
                alert('No inventory data found. Please go to the main inventory page first.');
                return;
            }

            // Clear previous data
            forecastData = new Array(inventoryData.items.length);
            let forecastIndex = 0;
            priorityQueue.clear();

            // Calculate forecast for each item (manual loop, no forEach)
            for (let idx = 0; idx < inventoryData.items.length; idx++) {
                let item = inventoryData.items[idx];
                
                // Calculate days until empty
                let daysUntilEmpty = Math.floor(item.qty / usageRate);
                
                // Calculate reorder date (considering lead time)
                let reorderInDays = daysUntilEmpty - leadTime;
                if (reorderInDays < 0) reorderInDays = 0; // Manual Math.max
                
                // Calculate urgency score (lower = more urgent)
                // Formula: (current stock / reorder threshold) * days until reorder
                let urgencyScore = (item.qty / reorderThreshold) * (reorderInDays + 1);
                
                // Determine status
                let status, statusClass, priority;
                if (daysUntilEmpty <= 3) {
                    status = 'Critical';
                    statusClass = 'critical';
                    priority = 1;
                } else if (daysUntilEmpty <= 7) {
                    status = 'Urgent';
                    statusClass = 'urgent';
                    priority = 2;
                } else if (daysUntilEmpty <= 14) {
                    status = 'Warning';
                    statusClass = 'warning';
                    priority = 3;
                } else {
                    status = 'Healthy';
                    statusClass = 'healthy';
                    priority = 4;
                }

                let forecastItem = {
                    id: item.id,
                    name: item.name,
                    currentStock: item.qty,
                    price: item.price,
                    dailyUsage: usageRate,
                    daysUntilEmpty: daysUntilEmpty,
                    reorderInDays: reorderInDays,
                    urgencyScore: urgencyScore,
                    status: status,
                    statusClass: statusClass,
                    priority: priority
                };

                forecastData[forecastIndex] = forecastItem;
                forecastIndex++;
                
                // Only add to priority queue if needs attention (not healthy)
                if (priority < 4) {
                    priorityQueue.enqueue(forecastItem);
                }
            }

            // Update displays
            updateSummaryCards();
            displayPriorityQueue();
            displayForecastTable();
            createForecastChart();

            feather.replace();
        }

        
        // Update Summary Cards
        // Manual counting without using filter - C-style
        
        function updateSummaryCards() {
            // Manual counting (like C loops)
            let critical = 0;
            let urgent = 0;
            let warning = 0;
            let healthy = 0;
            
            for (let i = 0; i < forecastData.length; i++) {
                if (forecastData[i].status === 'Critical') {
                    critical++;
                } else if (forecastData[i].status === 'Urgent') {
                    urgent++;
                } else if (forecastData[i].status === 'Warning') {
                    warning++;
                } else if (forecastData[i].status === 'Healthy') {
                    healthy++;
                }
            }

            document.getElementById('criticalCount').textContent = critical;
            document.getElementById('urgentCount').textContent = urgent;
            document.getElementById('warningCount').textContent = warning;
            document.getElementById('healthyCount').textContent = healthy;
        }

        
        // Display Priority Queue (Heap Visualization)
        // Shows items in heap order with priority levels
        
        function displayPriorityQueue() {
            const container = document.getElementById('priorityQueueContainer');
            const items = priorityQueue.getAll();

            if (items.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i data-feather="check-circle" class="w-12 h-12 mx-auto mb-2 text-green-500"></i>
                        <p>No items require immediate attention!</p>
                        <p class="text-sm mt-1">All inventory levels are healthy.</p>
                    </div>
                `;
                feather.replace();
                return;
            }

            let html = '';
            items.forEach((item, index) => {
                const priorityColors = {
                    1: 'bg-red-50 border-red-300',
                    2: 'bg-orange-50 border-orange-300',
                    3: 'bg-yellow-50 border-yellow-300'
                };

                const priorityIcons = {
                    1: '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8" class="text-red-600"/></svg>',
                    2: '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8" class="text-orange-600"/></svg>',
                    3: '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8" class="text-yellow-600"/></svg>'
                };

                html += `
                    <div class="flex items-center gap-4 p-4 border-2 rounded-lg ${priorityColors[item.priority]} hover:shadow-md transition">
                        <div class="text-2xl font-bold text-gray-400 w-8">${index + 1}</div>
                        <div class="flex items-center justify-center w-8">${priorityIcons[item.priority]}</div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <h3 class="font-semibold text-gray-800">${item.name}</h3>
                                <span class="text-sm font-medium px-3 py-1 rounded-full ${
                                    item.priority === 1 ? 'bg-red-100 text-red-700' :
                                    item.priority === 2 ? 'bg-orange-100 text-orange-700' :
                                    'bg-yellow-100 text-yellow-700'
                                }">${item.status}</span>
                            </div>
                            <div class="grid grid-cols-4 gap-4 mt-2 text-sm text-gray-600">
                                <div>
                                    <span class="font-medium">Stock:</span> ${item.currentStock} units
                                </div>
                                <div>
                                    <span class="font-medium">Empty in:</span> ${item.daysUntilEmpty} days
                                </div>
                                <div>
                                    <span class="font-medium">Reorder in:</span> ${item.reorderInDays} days
                                </div>
                                <div>
                                    <span class="font-medium">Urgency:</span> ${item.urgencyScore.toFixed(2)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        
        // Display Forecast Table
        
        
        // MERGE SORT for Forecast Data
        // Pure C-style implementation for sorting by any property
        
        function mergeSortForecast(arr, property, ascending) {
            let n = arr.length;
            if (n <= 1) return arr;
            
            let mid = Math.floor(n / 2);
            
            // Manual array copying
            let left = new Array(mid);
            let right = new Array(n - mid);
            
            // Copy left half
            for (let i = 0; i < mid; i++) {
                left[i] = arr[i];
            }
            
            // Copy right half
            for (let i = mid; i < n; i++) {
                right[i - mid] = arr[i];
            }
            
            // Recursive sort
            left = mergeSortForecast(left, property, ascending);
            right = mergeSortForecast(right, property, ascending);
            
            // Merge sorted halves
            return mergeForecast(left, right, property, ascending);
        }

        function mergeForecast(left, right, property, ascending) {
            let leftSize = left.length;
            let rightSize = right.length;
            let resultSize = leftSize + rightSize;
            let result = new Array(resultSize);
            
            let i = 0;  // Left pointer
            let j = 0;  // Right pointer
            let k = 0;  // Result pointer
            
            // Merge in sorted order
            while (i < leftSize && j < rightSize) {
                let comparison;
                if (ascending) {
                    comparison = left[i][property] < right[j][property];
                } else {
                    comparison = left[i][property] > right[j][property];
                }
                
                if (comparison) {
                    result[k] = left[i];
                    i++;
                } else {
                    result[k] = right[j];
                    j++;
                }
                k++;
            }
            
            // Copy remaining from left
            while (i < leftSize) {
                result[k] = left[i];
                i++;
                k++;
            }
            
            // Copy remaining from right
            while (j < rightSize) {
                result[k] = right[j];
                j++;
                k++;
            }
            
            return result;
        }

        
        // Display Forecast Table
        
        
        function displayForecastTable() {
            let tbody = document.getElementById('forecastTableBody');
            
            // Manual array copy
            let sortedData = new Array(forecastData.length);
            for (let i = 0; i < forecastData.length; i++) {
                sortedData[i] = forecastData[i];
            }
            
            // Merge Sort by urgency score (ascending)
            sortedData = mergeSortForecast(sortedData, 'urgencyScore', true);

            let html = '';
            for (let i = 0; i < sortedData.length; i++) {
                let item = sortedData[i];
                let today = new Date();
                let reorderDate = new Date(today.getTime() + (item.reorderInDays * 24 * 60 * 60 * 1000));
                
                let statusBadge;
                if (item.status === 'Critical') {
                    statusBadge = '<span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8"/></svg>Critical</span>';
                } else if (item.status === 'Urgent') {
                    statusBadge = '<span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8"/></svg>Urgent</span>';
                } else if (item.status === 'Warning') {
                    statusBadge = '<span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8"/></svg>Warning</span>';
                } else {
                    statusBadge = '<span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8"/></svg>Healthy</span>';
                }

                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${item.name}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${item.currentStock} units</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${item.dailyUsage} units/day</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${item.daysUntilEmpty} days</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${reorderDate.toLocaleDateString()}</td>
                        <td class="px-4 py-3 text-sm text-gray-700">${item.urgencyScore.toFixed(2)}</td>
                        <td class="px-4 py-3 text-sm">${statusBadge}</td>
                    </tr>
                `;
            }

            tbody.innerHTML = html;
        }

        
        // Create Forecast Chart
        // Visualizes stock depletion timeline
        
        
        function createForecastChart() {
            let ctx = document.getElementById('forecastChart').getContext('2d');
            
            // Manual array copy
            let sortedItems = new Array(forecastData.length);
            for (let i = 0; i < forecastData.length; i++) {
                sortedItems[i] = forecastData[i];
            }
            
            // Merge Sort by daysUntilEmpty (ascending)
            sortedItems = mergeSortForecast(sortedItems, 'daysUntilEmpty', true);
            
            // Get top 10 items manually
            let topCount = sortedItems.length < 10 ? sortedItems.length : 10;
            let topItems = new Array(topCount);
            for (let i = 0; i < topCount; i++) {
                topItems[i] = sortedItems[i];
            }
            
            // Manual map for labels
            let labels = new Array(topItems.length);
            for (let i = 0; i < topItems.length; i++) {
                let name = topItems[i].name;
                labels[i] = name.length > 20 ? name.substring(0, 20) : name;
            }
            
            // Manual map for data
            let data = new Array(topItems.length);
            for (let i = 0; i < topItems.length; i++) {
                data[i] = topItems[i].daysUntilEmpty;
            }
            
            // Manual map for background colors
            let backgroundColors = new Array(topItems.length);
            let borderColors = new Array(topItems.length);
            for (let i = 0; i < topItems.length; i++) {
                if (topItems[i].daysUntilEmpty <= 3) {
                    backgroundColors[i] = 'rgba(239, 68, 68, 0.7)';
                    borderColors[i] = 'rgba(239, 68, 68, 1)';
                } else if (topItems[i].daysUntilEmpty <= 7) {
                    backgroundColors[i] = 'rgba(249, 115, 22, 0.7)';
                    borderColors[i] = 'rgba(249, 115, 22, 1)';
                } else if (topItems[i].daysUntilEmpty <= 14) {
                    backgroundColors[i] = 'rgba(251, 191, 36, 0.7)';
                    borderColors[i] = 'rgba(251, 191, 36, 1)';
                } else {
                    backgroundColors[i] = 'rgba(34, 197, 94, 0.7)';
                    borderColors[i] = 'rgba(34, 197, 94, 1)';
                }
            }

            // Destroy previous chart if exists
            if (forecastChart) {
                forecastChart.destroy();
            }

            forecastChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Days Until Stock Empty',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const item = topItems[context.dataIndex];
                                    return [
                                        `Days until empty: ${item.daysUntilEmpty}`,
                                        `Current stock: ${item.currentStock} units`,
                                        `Status: ${item.status}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Days Until Empty'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Items (Most Urgent First)'
                            }
                        }
                    }
                }
            });
        }

        // Auto-run forecast on page load if data exists
        window.addEventListener('load', function() {
            const inventoryData = JSON.parse(localStorage.getItem('inventoryStats') || '{}');
            if (inventoryData.items && inventoryData.items.length > 0) {
                runForecast();
            } else {
                document.querySelector('main').innerHTML = `
                    <div class="min-h-screen flex items-center justify-center bg-gray-50">
                        <div class="text-center">
                            <i data-feather="alert-circle" class="w-16 h-16 text-red-500 mx-auto mb-4"></i>
                            <h1 class="text-2xl font-bold text-gray-800 mb-2">No Inventory Data Available</h1>
                            <p class="text-gray-600 mb-4">Please go back to the inventory page and click "View Statistics" first.</p>
                            <a href="index.html" class="btn-primary">Back to Inventory</a>
                        </div>
                    </div>
                `;
                feather.replace();
            }
        });
    </script>
</body>
</html>
